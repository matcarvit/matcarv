---------------- MICROSERVIÃ‡OS DE PRODUTOS ------------------
CREATE SCHEMA PRODUCTS;

--DROP CASCADE--
DROP TABLE IF EXISTS CATEGORIES CASCADE;
DROP TABLE IF EXISTS CATEGORIES_AUD CASCADE;
DROP TABLE IF EXISTS PRODUCTS CASCADE;
DROP TABLE IF EXISTS PRODUCTS_AUD CASCADE;
DROP TABLE IF EXISTS REVINFO CASCADE;

--CATEGORIAS--
CREATE TABLE CATEGORIES (
	ID_CATEGORY VARCHAR(255) NOT NULL, 
	DESCRIPTION VARCHAR(255) NOT NULL, 
	PRIMARY KEY (ID_CATEGORY)
);

CREATE TABLE CATEGORIES_AUD (
 	ID_CATEGORY VARCHAR(255) NOT NULL, 
 	REV INTEGER NOT NULL, 
 	REVTYPE TINYINT, 
 	DESCRIPTION VARCHAR(255), 
 	PRIMARY KEY (ID_CATEGORY, REV)
 );

--PRODUTOS--
CREATE TABLE PRODUCTS (
	ID_PRODUCT VARCHAR(255) NOT NULL, 
	DESCRIPTION VARCHAR(255) NOT NULL, 
	NAME VARCHAR(255) NOT NULL, 
	PRODUCT_DATE DATE NOT NULL, 
	PRODUCT_TYPE VARCHAR(255) NOT NULL, 
	QUANTITY DECIMAL(7,3) NOT NULL, 
	ID_CATEGORY VARCHAR(255) NOT NULL, 
	PRIMARY KEY (ID_PRODUCT)
);

CREATE TABLE PRODUCTS_AUD (
 	ID_PRODUCT VARCHAR(255) NOT NULL, 
 	REV INTEGER NOT NULL, 
 	REVTYPE TINYINT, 
 	DESCRIPTION VARCHAR(255), 
 	NAME VARCHAR(255), 
 	PRODUCT_DATE DATE, 
 	PRODUCT_TYPE VARCHAR(255), 
 	QUANTITY DECIMAL(7,3), 
 	PRIMARY KEY (ID_PRODUCT, REV)
 );
 
ALTER TABLE PRODUCTS ADD CONSTRAINT FKIP7B0Y8JA7FSM5WL7MHMSEH5N FOREIGN KEY (ID_CATEGORY) REFERENCES CATEGORIES;


--AUDIT--
CREATE TABLE REVINFO (
	REV INTEGER GENERATED BY DEFAULT AS IDENTITY, 
	REVTSTMP BIGINT, PRIMARY KEY (REV)
);

ALTER TABLE CATEGORIES_AUD ADD CONSTRAINT FK6TI58H8W0Q47OACSCU06HCITE FOREIGN KEY (REV) REFERENCES REVINFO;
ALTER TABLE PRODUCTS_AUD ADD CONSTRAINT FKIS5P0X6T8GVIB9M5RA1FIYBI3 FOREIGN KEY (REV) REFERENCES REVINFO;


